variables:
  imageName: 'quamotion/build-agent-windows:$(build.buildId)'

jobs:
- job: windows
  pool:
    vmImage: 'windows-2019'
  steps:
  - script: |
      docker login -u="$(DOCKER_USER)" -p="$(DOCKER_PASS)"
    condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
    displayName: 'docker login'

  - script: |
      cd windows
      docker build -f Dockerfile -t $(imageName) .
    displayName: 'docker build'

  - script: |
      docker push $(imageName)
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
    displayName: 'docker push'
